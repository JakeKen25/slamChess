openapi: 3.0.3
info:
  title: Slam Chess API
  version: 1.0.0
paths:
  /games:
    post:
      summary: Create a new game
      responses:
        '201':
          description: Game created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameStateResponse'
              examples:
                created-game:
                  summary: New game
                  value:
                    gameId: game_12345
                    status: active
                    state:
                      board:
                        a1:
                          color: white
                          type: rook
                        b1:
                          color: white
                          type: knight
                        e1:
                          color: white
                          type: king
                        e8:
                          color: black
                          type: king
                      turn: white
                      castlingRights:
                        white:
                          kingSide: true
                          queenSide: true
                        black:
                          kingSide: true
                          queenSide: true
                      history: []
                    events:
                      - type: Moved
                        player: white
                        move:
                          from: e2
                          to: e4
                          piece:
                            color: white
                            type: pawn
                          moveType: normal
                          san: e4
                        moveNumber: 0
                        timestamp: '2026-02-10T09:30:00Z'
                        resultingTurn: black
        '500':
          $ref: '#/components/responses/InternalServerError'
  /games/{gameId}:
    get:
      summary: Get game state
      parameters:
        - $ref: '#/components/parameters/GameId'
      responses:
        '200':
          description: Current game state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameStateResponse'
              examples:
                game-state:
                  summary: Active game state
                  value:
                    gameId: game_12345
                    status: active
                    state:
                      board:
                        e4:
                          color: white
                          type: pawn
                        e5:
                          color: black
                          type: pawn
                        e1:
                          color: white
                          type: king
                        e8:
                          color: black
                          type: king
                      turn: white
                      castlingRights:
                        white:
                          kingSide: true
                          queenSide: true
                        black:
                          kingSide: true
                          queenSide: true
                      history:
                        - from: e2
                          to: e4
                          piece:
                            color: white
                            type: pawn
                          moveType: normal
                          san: e4
                        - from: e7
                          to: e5
                          piece:
                            color: black
                            type: pawn
                          moveType: normal
                          san: e5
                    events:
                      - type: Moved
                        player: black
                        move:
                          from: e7
                          to: e5
                          piece:
                            color: black
                            type: pawn
                          moveType: normal
                          san: e5
                        moveNumber: 1
                        timestamp: '2026-02-10T09:33:00Z'
                        resultingTurn: white
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /games/{gameId}/moves:
    post:
      summary: Submit move
      parameters:
        - $ref: '#/components/parameters/GameId'
        - name: x-player-id
          in: header
          required: true
          schema:
            type: string
          description: Player identity token that must match the currently active seat.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MoveSubmissionRequest'
            examples:
              kings-pawn:
                summary: Standard opening move
                value:
                  from: e2
                  to: e4
                  moveType: normal
      responses:
        '200':
          description: Move accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameStateResponse'
              examples:
                updated-state:
                  summary: State after a normal move
                  value:
                    gameId: game_12345
                    status: active
                    state:
                      board:
                        e4:
                          color: white
                          type: pawn
                        e1:
                          color: white
                          type: king
                        e8:
                          color: black
                          type: king
                      turn: black
                      castlingRights:
                        white:
                          kingSide: true
                          queenSide: true
                        black:
                          kingSide: true
                          queenSide: true
                      history:
                        - from: e2
                          to: e4
                          piece:
                            color: white
                            type: pawn
                          moveType: normal
                          san: e4
                    events:
                      - type: Moved
                        player: white
                        move:
                          from: e2
                          to: e4
                          piece:
                            color: white
                            type: pawn
                          moveType: normal
                          san: e4
                        moveNumber: 1
                        timestamp: '2026-02-10T09:33:00Z'
                        resultingTurn: black
                slam-with-promotion:
                  summary: State after slam move with destruction and promotion
                  value:
                    gameId: game_98765
                    status: active
                    state:
                      board:
                        g8:
                          color: white
                          type: queen
                        e1:
                          color: white
                          type: king
                        e8:
                          color: black
                          type: king
                      turn: black
                      castlingRights:
                        white:
                          kingSide: false
                          queenSide: false
                        black:
                          kingSide: false
                          queenSide: false
                      history:
                        - from: g7
                          to: g8
                          piece:
                            color: white
                            type: pawn
                          moveType: slam
                          promotedTo: queen
                          destroyedSquares:
                            - f8
                            - h8
                          san: g8=Q
                    events:
                      - type: Moved
                        player: white
                        move:
                          from: g7
                          to: g8
                          piece:
                            color: white
                            type: pawn
                          moveType: slam
                          promotedTo: queen
                          destroyedSquares:
                            - f8
                            - h8
                          san: g8=Q
                        moveNumber: 23
                        timestamp: '2026-02-10T10:02:00Z'
                        resultingTurn: black
                      - type: Slammed
                        player: white
                        at: g8
                        destroyedSquares:
                          - f8
                          - h8
                        moveNumber: 23
                        timestamp: '2026-02-10T10:02:00Z'
                      - type: Destroyed
                        square: f8
                        destroyedPiece:
                          color: black
                          type: rook
                        moveNumber: 23
                        timestamp: '2026-02-10T10:02:00Z'
                      - type: Destroyed
                        square: h8
                        destroyedPiece:
                          color: black
                          type: rook
                        moveNumber: 23
                        timestamp: '2026-02-10T10:02:00Z'
                      - type: Promotion
                        player: white
                        square: g8
                        from: pawn
                        to: queen
                        moveNumber: 23
                        timestamp: '2026-02-10T10:02:00Z'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /games/{gameId}/join:
    post:
      summary: Claim a white or black player seat for a game
      parameters:
        - $ref: '#/components/parameters/GameId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [color]
              properties:
                color:
                  type: string
                  enum: [white, black]
                playerId:
                  type: string
      responses:
        '200':
          description: Seat assigned to player
        '409':
          description: Seat is already taken
  /games/{gameId}/history:
    get:
      summary: List move history
      parameters:
        - $ref: '#/components/parameters/GameId'
      responses:
        '200':
          description: List of moves submitted in order
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HistoryResponse'
              examples:
                opening-history:
                  summary: First two plies
                  value:
                    gameId: game_12345
                    moves:
                      - moveNumber: 1
                        player: white
                        from: e2
                        to: e4
                        piece:
                          color: white
                          type: pawn
                        moveType: normal
                        san: e4
                        timestamp: '2026-02-10T09:33:00Z'
                      - moveNumber: 1
                        player: black
                        from: e7
                        to: e5
                        piece:
                          color: black
                          type: pawn
                        moveType: normal
                        san: e5
                        timestamp: '2026-02-10T09:33:45Z'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /games/{gameId}/legal-moves:
    get:
      summary: List legal moves
      parameters:
        - $ref: '#/components/parameters/GameId'
      responses:
        '200':
          description: Legal destination squares from each origin square
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LegalMovesResponse'
              examples:
                white-to-move:
                  summary: Start position legal moves
                  value:
                    gameId: game_12345
                    byOrigin:
                      a2:
                        - a3
                        - a4
                      b1:
                        - a3
                        - c3
                    legalMoves:
                      - from: a2
                        to: a3
                        piece:
                          color: white
                          type: pawn
                        moveType: normal
                      - from: a2
                        to: a4
                        piece:
                          color: white
                          type: pawn
                        moveType: normal
                      - from: b1
                        to: a3
                        piece:
                          color: white
                          type: knight
                        moveType: normal
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  parameters:
    GameId:
      name: gameId
      in: path
      required: true
      schema:
        type: string
      description: Unique identifier of the game.

  responses:
    BadRequest:
      description: Request validation failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            invalid-square:
              summary: Invalid square format
              value:
                error: Invalid square format for `from`
                code: INVALID_REQUEST
    NotFound:
      description: Resource was not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            game-not-found:
              summary: Unknown game ID
              value:
                error: Game not found
                code: GAME_NOT_FOUND
    Conflict:
      description: Request conflicts with current game state
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            illegal-move:
              summary: Move rejected
              value:
                error: Illegal move for current player
                code: ILLEGAL_MOVE
    InternalServerError:
      description: Unexpected server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            unexpected:
              summary: Generic failure
              value:
                error: An unexpected error occurred

  schemas:
    Square:
      type: string
      pattern: '^[a-h][1-8]$'
      example: e4

    PieceColor:
      type: string
      enum: [white, black]

    PieceType:
      type: string
      enum: [pawn, knight, bishop, rook, queen, king]

    Piece:
      type: object
      additionalProperties: false
      required:
        - color
        - type
      properties:
        color:
          $ref: '#/components/schemas/PieceColor'
        type:
          $ref: '#/components/schemas/PieceType'

    CastlingSideRights:
      type: object
      additionalProperties: false
      required:
        - kingSide
        - queenSide
      properties:
        kingSide:
          type: boolean
        queenSide:
          type: boolean

    CastlingRights:
      type: object
      additionalProperties: false
      required:
        - white
        - black
      properties:
        white:
          $ref: '#/components/schemas/CastlingSideRights'
        black:
          $ref: '#/components/schemas/CastlingSideRights'

    Move:
      type: object
      additionalProperties: false
      required:
        - from
        - to
        - piece
        - moveType
      properties:
        from:
          $ref: '#/components/schemas/Square'
        to:
          $ref: '#/components/schemas/Square'
        piece:
          $ref: '#/components/schemas/Piece'
        moveType:
          type: string
          enum: [normal, slam]
          description: '`slam` indicates a slam chess move with blast effects.'
        promotedTo:
          $ref: '#/components/schemas/PieceType'
        destroyedSquares:
          type: array
          items:
            $ref: '#/components/schemas/Square'
        san:
          type: string
          description: Standard Algebraic Notation.
          example: e4

    MoveSubmissionRequest:
      type: object
      additionalProperties: false
      required:
        - from
        - to
        - moveType
      properties:
        from:
          $ref: '#/components/schemas/Square'
        to:
          $ref: '#/components/schemas/Square'
        moveType:
          type: string
          enum: [normal, slam]
        promoteTo:
          $ref: '#/components/schemas/PieceType'
      description: Client-submitted move intent.

    GameStateResponse:
      type: object
      additionalProperties: false
      required:
        - gameId
        - status
        - state
        - events
      properties:
        gameId:
          type: string
          example: game_12345
        status:
          type: string
          enum: [active, checkmate, stalemate, resigned, draw]
          example: active
        state:
          $ref: '#/components/schemas/GameState'
        events:
          type: array
          items:
            $ref: '#/components/schemas/GameEvent'

    GameState:
      type: object
      additionalProperties: false
      required:
        - board
        - turn
        - castlingRights
        - history
      properties:
        board:
          type: object
          description: Map of occupied squares to piece metadata.
          additionalProperties:
            $ref: '#/components/schemas/Piece'
        turn:
          $ref: '#/components/schemas/PieceColor'
        castlingRights:
          $ref: '#/components/schemas/CastlingRights'
        history:
          type: array
          items:
            $ref: '#/components/schemas/Move'

    GameEvent:
      oneOf:
        - $ref: '#/components/schemas/MovedEvent'
        - $ref: '#/components/schemas/SlammedEvent'
        - $ref: '#/components/schemas/DestroyedEvent'
        - $ref: '#/components/schemas/PromotionEvent'
        - $ref: '#/components/schemas/CheckEvent'
        - $ref: '#/components/schemas/CheckmateEvent'
      discriminator:
        propertyName: type
        mapping:
          Moved: '#/components/schemas/MovedEvent'
          Slammed: '#/components/schemas/SlammedEvent'
          Destroyed: '#/components/schemas/DestroyedEvent'
          Promotion: '#/components/schemas/PromotionEvent'
          Check: '#/components/schemas/CheckEvent'
          Checkmate: '#/components/schemas/CheckmateEvent'

    GameEventBase:
      type: object
      additionalProperties: false
      required:
        - type
        - moveNumber
        - timestamp
      properties:
        type:
          type: string
        moveNumber:
          type: integer
          minimum: 0
          example: 12
        timestamp:
          type: string
          format: date-time
          example: '2026-02-10T09:33:00Z'

    MovedEvent:
      allOf:
        - $ref: '#/components/schemas/GameEventBase'
        - type: object
          required: [type, player, move, resultingTurn]
          properties:
            type:
              type: string
              enum: [Moved]
            player:
              $ref: '#/components/schemas/PieceColor'
            move:
              $ref: '#/components/schemas/Move'
            resultingTurn:
              $ref: '#/components/schemas/PieceColor'

    SlammedEvent:
      allOf:
        - $ref: '#/components/schemas/GameEventBase'
        - type: object
          required: [type, player, at, destroyedSquares]
          properties:
            type:
              type: string
              enum: [Slammed]
            player:
              $ref: '#/components/schemas/PieceColor'
            at:
              $ref: '#/components/schemas/Square'
            destroyedSquares:
              type: array
              items:
                $ref: '#/components/schemas/Square'

    DestroyedEvent:
      allOf:
        - $ref: '#/components/schemas/GameEventBase'
        - type: object
          required: [type, square, destroyedPiece]
          properties:
            type:
              type: string
              enum: [Destroyed]
            square:
              $ref: '#/components/schemas/Square'
            destroyedPiece:
              $ref: '#/components/schemas/Piece'

    PromotionEvent:
      allOf:
        - $ref: '#/components/schemas/GameEventBase'
        - type: object
          required: [type, player, square, from, to]
          properties:
            type:
              type: string
              enum: [Promotion]
            player:
              $ref: '#/components/schemas/PieceColor'
            square:
              $ref: '#/components/schemas/Square'
            from:
              type: string
              enum: [pawn]
            to:
              $ref: '#/components/schemas/PieceType'

    CheckEvent:
      allOf:
        - $ref: '#/components/schemas/GameEventBase'
        - type: object
          required: [type, checkedPlayer]
          properties:
            type:
              type: string
              enum: [Check]
            checkedPlayer:
              $ref: '#/components/schemas/PieceColor'

    CheckmateEvent:
      allOf:
        - $ref: '#/components/schemas/GameEventBase'
        - type: object
          required: [type, winner, loser]
          properties:
            type:
              type: string
              enum: [Checkmate]
            winner:
              $ref: '#/components/schemas/PieceColor'
            loser:
              $ref: '#/components/schemas/PieceColor'

    HistoryResponse:
      type: object
      required:
        - gameId
        - moves
      properties:
        gameId:
          type: string
          example: game_12345
        moves:
          type: array
          items:
            $ref: '#/components/schemas/HistoryMove'

    HistoryMove:
      allOf:
        - $ref: '#/components/schemas/Move'
        - type: object
          additionalProperties: false
          required:
            - moveNumber
            - player
            - timestamp
          properties:
            moveNumber:
              type: integer
              minimum: 1
              example: 1
            player:
              $ref: '#/components/schemas/PieceColor'
            timestamp:
              type: string
              format: date-time
              example: '2026-02-10T09:33:00Z'

    LegalMovesResponse:
      type: object
      additionalProperties: false
      required:
        - gameId
        - byOrigin
        - legalMoves
      properties:
        gameId:
          type: string
          example: game_12345
        byOrigin:
          type: object
          description: Map of origin square to legal destination squares.
          additionalProperties:
            type: array
            items:
              $ref: '#/components/schemas/Square'
        legalMoves:
          type: array
          description: Fully typed legal moves suitable for code generation.
          items:
            $ref: '#/components/schemas/Move'

    ErrorResponse:
      type: object
      additionalProperties: false
      required:
        - error
      properties:
        error:
          type: string
          example: Invalid move
        code:
          type: string
          description: Optional machine-readable error code.
          example: ILLEGAL_MOVE
